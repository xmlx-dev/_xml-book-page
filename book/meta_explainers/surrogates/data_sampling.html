
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>1.2. Data Sampling &#8212; eXplainable&lt;br&gt;Machine Learning</title>
    
  <link href="../../../_static/css/theme.css" rel="stylesheet">
  <link href="../../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/xmlx.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="canonical" href="https://book.xmlx.io/book/meta_explainers/surrogates/data_sampling.html" />
    <link rel="shortcut icon" href="../../../_static/bulb.svg"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="1.3. Explanation Generation" href="explanation_generation.html" />
    <link rel="prev" title="1.1. Binary Interpretable Representations for Tabular Data" href="interpretable_representations.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-6635EH38S9"></script>
<script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-6635EH38S9');
                </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../../_static/bulb.svg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">eXplainable<br>Machine Learning</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../README.html">
   eXplainable Machine Learning
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../preface/index.html">
   Preface
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../preface/glossary.html">
     Glossary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../preface/preliminary.html">
     Preliminary Information
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../preface/data.html">
     Modules, Data Sets and Models
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../index.html">
   Meta-Explainers
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="index.html">
     1. Surrogates
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="interpretable_representations.html">
       1.1. Binary Interpretable Representations for Tabular Data
      </a>
     </li>
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="#">
       1.2. Data Sampling
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="explanation_generation.html">
       1.3. Explanation Generation
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="examples.html">
       1.4. Interactive Examples
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
      <label for="toctree-checkbox-4">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="ex_tabular.html">
         1.4.1. Surrogate Explainer of Tabular Data
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="ex_ols.html">
         1.4.2. Investigating Linear Surrogate Explainers of Tabular Data
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../bibliography.html">
   Bibliography
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../genindex.html">
   Index
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://book.xmlx.io/docs/">
   XML Book Documentation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://xmlx.io/">
   XMLX Homepage
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  <a href="https://doi.org/XX.XXXX/zenodo.XXXXXXX"><img src="https://zenodo.org/badge/DOI/XX.XXXX/zenodo.XXXXXXX.svg" alt="DOI"></a>

</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        <a class="dropdown-buttons"
            href="../../../_sources/book/meta_explainers/surrogates/data_sampling.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download notebook file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../../_sources/book/meta_explainers/surrogates/data_sampling.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/xmlx-io/xml-book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/xmlx-io/xml-book/issues/new?title=Issue%20on%20page%20%2Fbook/meta_explainers/surrogates/data_sampling.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/xmlx-io/xml-book/edit/master/book/meta_explainers/surrogates/data_sampling.md"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/xmlx-io/xml-book/master?urlpath=lab/tree/book/meta_explainers/surrogates/data_sampling.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#toy-example-two-moons">
   1.2.1. Toy Example – Two Moons
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#loading-the-data">
     Loading the Data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#loading-the-black-box-models">
     Loading the Black-Box Models
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#selecting-an-instance-to-be-explained">
     Selecting an Instance to be Explained
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sampling">
     Sampling
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#normal-sampling">
       Normal Sampling
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#truncated-normal-sampling">
       Truncated Normal Sampling
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#mixup-sampling">
       Mixup Sampling
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#normal-class-discovery">
       Normal Class Discovery
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#samplers-comparison">
       Samplers Comparison
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#measuring-sampling-quality">
     Measuring Sampling Quality
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sampling-from-interpretable-representations">
     Sampling from Interpretable Representations
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#real-life-data-bikes-sharing">
   1.2.2. Real-life Data – Bikes Sharing
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#loading-data-and-black-boxes">
     Loading Data and Black Boxes
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#choosing-instances">
     Choosing Instances
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#testing-samplers">
     Testing Samplers
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary">
   1.2.3. Summary
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Data Sampling</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#toy-example-two-moons">
   1.2.1. Toy Example – Two Moons
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#loading-the-data">
     Loading the Data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#loading-the-black-box-models">
     Loading the Black-Box Models
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#selecting-an-instance-to-be-explained">
     Selecting an Instance to be Explained
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sampling">
     Sampling
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#normal-sampling">
       Normal Sampling
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#truncated-normal-sampling">
       Truncated Normal Sampling
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#mixup-sampling">
       Mixup Sampling
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#normal-class-discovery">
       Normal Class Discovery
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#samplers-comparison">
       Samplers Comparison
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#measuring-sampling-quality">
     Measuring Sampling Quality
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sampling-from-interpretable-representations">
     Sampling from Interpretable Representations
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#real-life-data-bikes-sharing">
   1.2.2. Real-life Data – Bikes Sharing
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#loading-data-and-black-boxes">
     Loading Data and Black Boxes
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#choosing-instances">
     Choosing Instances
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#testing-samplers">
     Testing Samplers
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary">
   1.2.3. Summary
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="data-sampling">
<span id="text-meta-explainers-surrogates-data-sampling"></span><h1><span class="section-number">1.2. </span>Data Sampling<a class="headerlink" href="#data-sampling" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># First, we need to set up the environment.</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;../../../_code&#39;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">fatf</span>
<span class="kn">import</span> <span class="nn">xml_book.data</span>
<span class="kn">import</span> <span class="nn">xml_book.models</span>
<span class="kn">import</span> <span class="nn">xml_book.surrogates</span>

<span class="kn">import</span> <span class="nn">fatf.utils.data.augmentation</span> <span class="k">as</span> <span class="nn">fatf_augmentation</span>
<span class="kn">import</span> <span class="nn">fatf.utils.data.discretisation</span> <span class="k">as</span> <span class="nn">fatf_discretisation</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>22-Mar-21 18:33:55 fatf.utils.array.tools INFO     Using numpy&#39;s numpy.lib.recfunctions.structured_to_unstructured as fatf.utils.array.tools.structured_to_unstructured and fatf.utils.array.tools.structured_to_unstructured_row.
</pre></div>
</div>
</div>
</div>
<p>This notebook goes over a selection of data sampling methods and investigates
their behaviour with respect to the produced data.
To this end, we use implementations included in the
<a class="reference external" href="https://fat-forensics.org/api.html#module-fatf.utils.data.augmentation"><code class="docutils literal notranslate"><span class="pre">fatf.utils.data.augmentation</span></code></a>
module.
In particular, we will look at four different sampling methods for tabular data:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://fat-forensics.org/generated/fatf.utils.data.augmentation.NormalSampling.html">Normal Sampling</a>;</p></li>
<li><p><a class="reference external" href="https://fat-forensics.org/generated/fatf.utils.data.augmentation.TruncatedNormalSampling.html">Truncated Normal Sampling</a>;</p></li>
<li><p><a class="reference external" href="https://fat-forensics.org/generated/fatf.utils.data.augmentation.Mixup.html">Mixup</a>; and</p></li>
<li><p><a class="reference external" href="https://fat-forensics.org/generated/fatf.utils.data.augmentation.NormalClassDiscovery.html">Normal Class Discovery</a>.</p></li>
</ul>
<p>These four approaches are implemented in FAT Forensics and are ready for you
to use out of the box.
Nonetheless, writing your own sampler is relatively easy.
You can use the abstract <code class="docutils literal notranslate"><span class="pre">fatf.data.utils.augmentation.Augmentation</span></code>
class as the foundation of your own method.
It implements a collection of helper methods and in most of the cases writing
your own <code class="docutils literal notranslate"><span class="pre">__init__</span></code> and <code class="docutils literal notranslate"><span class="pre">sample</span></code> methods suffices.</p>
<section id="toy-example-two-moons">
<h2><span class="section-number">1.2.1. </span>Toy Example – Two Moons<a class="headerlink" href="#toy-example-two-moons" title="Permalink to this headline">¶</a></h2>
<p>Let’s start with the Two Moons data set – it is two-dimensional,
which allows us to visualise the behaviour of each sampler and more easily
convey the idea behind them.</p>
<section id="loading-the-data">
<h3>Loading the Data<a class="headerlink" href="#loading-the-data" title="Permalink to this headline">¶</a></h3>
<p>We start by loading the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">moons_X</span><span class="p">,</span> <span class="n">moons_X_test</span><span class="p">,</span> <span class="n">moons_y</span><span class="p">,</span> <span class="n">moons_y_test</span> <span class="o">=</span> <span class="n">xml_book</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">generate_2d_moons</span><span class="p">(</span>
    <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>22-Mar-21 18:33:56 fatf         INFO     Seeding RNGs using the input parameter.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>22-Mar-21 18:33:56 fatf         INFO     Seeding RNGs with 42.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">moons_y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.PathCollection at 0x11d0cbc70&gt;
</pre></div>
</div>
<img alt="../../../_images/data_sampling_6_1.png" src="../../../_images/data_sampling_6_1.png" />
</div>
</div>
</section>
<section id="loading-the-black-box-models">
<h3>Loading the Black-Box Models<a class="headerlink" href="#loading-the-black-box-models" title="Permalink to this headline">¶</a></h3>
<p>Next, we load our <em>crisp</em> and <em>probabilistic</em> black boxes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clf_moons_proba</span> <span class="o">=</span> <span class="n">xml_book</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">get_random_forest</span><span class="p">(</span>
    <span class="n">moons_X</span><span class="p">,</span> <span class="n">moons_y</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>22-Mar-21 18:33:56 fatf         INFO     Seeding RNGs using the input parameter.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>22-Mar-21 18:33:56 fatf         INFO     Seeding RNGs with 42.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clf_moons_crisp</span> <span class="o">=</span> <span class="n">xml_book</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">get_svc</span><span class="p">(</span>
    <span class="n">moons_X</span><span class="p">,</span> <span class="n">moons_y</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>22-Mar-21 18:33:56 fatf         INFO     Seeding RNGs using the input parameter.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>22-Mar-21 18:33:56 fatf         INFO     Seeding RNGs with 42.
</pre></div>
</div>
</div>
</div>
</section>
<section id="selecting-an-instance-to-be-explained">
<h3>Selecting an Instance to be Explained<a class="headerlink" href="#selecting-an-instance-to-be-explained" title="Permalink to this headline">¶</a></h3>
<p>Now, let’s select three instances to be explained – thus sampled around –
each one with different characteristics:</p>
<ul class="simple">
<li><p>the mean of the data set;</p></li>
<li><p>a point close to a decision boundary; and</p></li>
<li><p>an instance that is far from a decision boundary.</p></li>
</ul>
<p>These three data points will help us to observe artefacts of our sampling
strategies.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Data points chosen to be sampled around</span>
<span class="n">moons_mean_point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">moons_X</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">moons_boundary_point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">])</span>
<span class="n">moons_far_point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the points we are going to sample around</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">moons_y</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_mean_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">moons_mean_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean Point&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_boundary_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">moons_boundary_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Boundary Point&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_far_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">moons_far_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Far Point&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x11d1f1df0&gt;
</pre></div>
</div>
<img alt="../../../_images/data_sampling_12_1.png" src="../../../_images/data_sampling_12_1.png" />
</div>
</div>
</section>
<section id="sampling">
<h3>Sampling<a class="headerlink" href="#sampling" title="Permalink to this headline">¶</a></h3>
<p>Let’s move on to sampling.
We are going to sample 150 data points around each instance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">moons_samples_number</span> <span class="o">=</span> <span class="mi">150</span>
</pre></div>
</div>
</div>
</div>
<section id="normal-sampling">
<h4>Normal Sampling<a class="headerlink" href="#normal-sampling" title="Permalink to this headline">¶</a></h4>
<p>We will start with <em>Normal Sampling</em>, which is accessible via the
<a class="reference external" href="https://fat-forensics.org/generated/fatf.utils.data.augmentation.NormalSampling.html">fatf.data.utils.augmentation.NormalSampling</a>
class.</p>
<p>This sampler uses normal distribution <span class="math notranslate nohighlight">\(\mathcal{N}(\mu, \sigma^2)\)</span>
separately for each individual feature.
<span class="math notranslate nohighlight">\(\sigma^2\)</span> is the standard deviation of this feature calculated for the data
set used to initialise this sampler.
<span class="math notranslate nohighlight">\(\mu\)</span> is either the mean value of this feature calculated for the data set used
to initialise this sampler or a user-specified instance.
This is controlled by calling the <code class="docutils literal notranslate"><span class="pre">sample</span></code> method of the Normal Sampler:</p>
<ul class="simple">
<li><p>if no argument is passed to the <code class="docutils literal notranslate"><span class="pre">sample</span></code> method, the mean of the
class initialisation data is used, e.g., <code class="docutils literal notranslate"><span class="pre">normal_sampler.sample()</span></code>; and</p></li>
<li><p>if an instance is passed to the <code class="docutils literal notranslate"><span class="pre">sample</span></code> method, this data point is
used instead, e.g., <code class="docutils literal notranslate"><span class="pre">normal_sampler.sample(np.array([4,</span> <span class="pre">2]))</span></code>.</p></li>
</ul>
<blockquote>
<div><p><strong>Tip:</strong>    
<em>Click on the URL behind the class name to open its API documentation,
which contains a more in-depth description.</em></p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">moons_normal_sampler</span> <span class="o">=</span> <span class="n">fatf_augmentation</span><span class="o">.</span><span class="n">NormalSampling</span><span class="p">(</span>
    <span class="n">moons_X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We start with the <em>mean</em> instance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">moons_normal_sample_mean</span> <span class="o">=</span> <span class="n">moons_normal_sampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
        <span class="n">moons_mean_point</span><span class="p">,</span>
        <span class="n">samples_number</span><span class="o">=</span><span class="n">moons_samples_number</span><span class="p">)</span>

<span class="n">moons_normal_sample_mean_crisp</span> <span class="o">=</span> <span class="n">clf_moons_crisp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
    <span class="n">moons_normal_sample_mean</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we move on to the <em>boundary</em> data point.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">moons_normal_sample_close</span> <span class="o">=</span> <span class="n">moons_normal_sampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
    <span class="n">moons_boundary_point</span><span class="p">,</span>
    <span class="n">samples_number</span><span class="o">=</span><span class="n">moons_samples_number</span><span class="p">)</span>

<span class="n">moons_normal_sample_close_crisp</span> <span class="o">=</span> <span class="n">clf_moons_crisp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
    <span class="n">moons_normal_sample_close</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And we finish with the <em>far</em> data point.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">moons_normal_sample_far</span> <span class="o">=</span> <span class="n">moons_normal_sampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
    <span class="n">moons_far_point</span><span class="p">,</span>
    <span class="n">samples_number</span><span class="o">=</span><span class="n">moons_samples_number</span><span class="p">)</span>

<span class="n">moons_normal_sample_far_crisp</span> <span class="o">=</span> <span class="n">clf_moons_crisp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
    <span class="n">moons_normal_sample_far</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now, let’s visualise these three samples side by side.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>


<span class="c1"># Scatter the data</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">moons_y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">moons_y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">moons_y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="c1"># Mean</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Mean Point&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_normal_sample_mean</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">moons_normal_sample_mean</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">moons_normal_sample_mean_crisp</span><span class="p">,</span>
    <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_mean_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">moons_mean_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean Point&#39;</span><span class="p">)</span>

<span class="c1"># Close</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Close Point&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_normal_sample_close</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">moons_normal_sample_close</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">moons_normal_sample_close_crisp</span><span class="p">,</span>
    <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_boundary_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">moons_boundary_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Boundary Point&#39;</span><span class="p">)</span>

<span class="c1"># Far</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Far Point&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_normal_sample_far</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">moons_normal_sample_far</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">moons_normal_sample_far_crisp</span><span class="p">,</span>
    <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_far_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">moons_far_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Far Point&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.PathCollection at 0x11d31fb80&gt;
</pre></div>
</div>
<img alt="../../../_images/data_sampling_24_1.png" src="../../../_images/data_sampling_24_1.png" />
</div>
</div>
</section>
<section id="truncated-normal-sampling">
<h4>Truncated Normal Sampling<a class="headerlink" href="#truncated-normal-sampling" title="Permalink to this headline">¶</a></h4>
<p><em>Truncated Normal Sampling</em> is accessible via the
<a class="reference external" href="https://fat-forensics.org/generated/fatf.utils.data.augmentation.TruncatedNormalSampling.html">fatf.data.utils.augmentation.TruncatedNormalSampling</a>
class.</p>
<p>This sampler is the same as <code class="docutils literal notranslate"><span class="pre">fatf.data.utils.augmentation.NormalSampling</span></code>,
except for the sampled values being truncated at the minimum and maximum of
each feature – these cut off points are computed based on the data set used
to initialise this class.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">moons_truncated_sampler</span> <span class="o">=</span> <span class="n">fatf_augmentation</span><span class="o">.</span><span class="n">TruncatedNormalSampling</span><span class="p">(</span>
    <span class="n">moons_X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s see how it works for the <em>mean</em> instance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">moons_truncated_sample_mean</span> <span class="o">=</span> <span class="n">moons_truncated_sampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
        <span class="n">moons_mean_point</span><span class="p">,</span>
        <span class="n">samples_number</span><span class="o">=</span><span class="n">moons_samples_number</span><span class="p">)</span>

<span class="n">moons_truncated_sample_mean_crisp</span> <span class="o">=</span> <span class="n">clf_moons_crisp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
    <span class="n">moons_truncated_sample_mean</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now, the <em>boundary</em> instance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">moons_truncated_sample_close</span> <span class="o">=</span> <span class="n">moons_truncated_sampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
    <span class="n">moons_boundary_point</span><span class="p">,</span>
    <span class="n">samples_number</span><span class="o">=</span><span class="n">moons_samples_number</span><span class="p">)</span>

<span class="n">moons_truncated_sample_close_crisp</span> <span class="o">=</span> <span class="n">clf_moons_crisp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
    <span class="n">moons_truncated_sample_close</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And the <em>far</em> instance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">moons_truncated_sample_far</span> <span class="o">=</span> <span class="n">moons_truncated_sampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
    <span class="n">moons_far_point</span><span class="p">,</span>
    <span class="n">samples_number</span><span class="o">=</span><span class="n">moons_samples_number</span><span class="p">)</span>

<span class="n">moons_truncated_sample_far_crisp</span> <span class="o">=</span> <span class="n">clf_moons_crisp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
    <span class="n">moons_truncated_sample_far</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now, let’s visualise these three samples side by side.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>


<span class="c1"># Scatter the data</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">moons_y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">moons_y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">moons_y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="c1"># Mean</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Mean Point&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_truncated_sample_mean</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">moons_truncated_sample_mean</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">moons_truncated_sample_mean_crisp</span><span class="p">,</span>
    <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_mean_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">moons_mean_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean Point&#39;</span><span class="p">)</span>

<span class="c1"># Close</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Close Point&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_truncated_sample_close</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">moons_truncated_sample_close</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">moons_truncated_sample_close_crisp</span><span class="p">,</span>
    <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_boundary_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">moons_boundary_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Boundary Point&#39;</span><span class="p">)</span>

<span class="c1"># Far</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Far Point&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_truncated_sample_far</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">moons_truncated_sample_far</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">moons_truncated_sample_far_crisp</span><span class="p">,</span>
    <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_far_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">moons_far_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Far Point&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.PathCollection at 0x11d453ac0&gt;
</pre></div>
</div>
<img alt="../../../_images/data_sampling_34_1.png" src="../../../_images/data_sampling_34_1.png" />
</div>
</div>
</section>
<section id="mixup-sampling">
<h4>Mixup Sampling<a class="headerlink" href="#mixup-sampling" title="Permalink to this headline">¶</a></h4>
<p><em>Mixup Sampling</em> is accessible via the
<a class="reference external" href="https://fat-forensics.org/generated/fatf.utils.data.augmentation.Mixup.html">fatf.data.utils.augmentation.Mixup</a>
class.</p>
<p>For a specific data point, this sampler first selects instances at random from
the data set that was used to initialise the sampler.
Then, it draws (<em>numeric</em>) samples from a Beta distribution and uses them to
compose new <em>data</em> samples according to the convex combination of these samples
and the instances randomly sampled from the data set.
Given points <span class="math notranslate nohighlight">\(x_i\)</span>, <span class="math notranslate nohighlight">\(x_j\)</span> and their labels <span class="math notranslate nohighlight">\(y_i\)</span>, <span class="math notranslate nohighlight">\(y_j\)</span> drawn at random from the
initialisation data set, and <span class="math notranslate nohighlight">\(\lambda\)</span> drawn from a Beta distribution,
a new data point is created as follows:</p>
<div class="amsmath math notranslate nohighlight" id="equation-e94445be-5261-4929-b56c-f2606c5370ed">
<span class="eqno">(1.1)<a class="headerlink" href="#equation-e94445be-5261-4929-b56c-f2606c5370ed" title="Permalink to this equation">¶</a></span>\[\begin{align}
\tilde{x} &amp;= \lambda x_i + (1-\lambda)x_j \\
\tilde{y} &amp;= \lambda y_i + (1-\lambda)y_j
\end{align}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">moons_mixup_sampler</span> <span class="o">=</span> <span class="n">fatf_augmentation</span><span class="o">.</span><span class="n">Mixup</span><span class="p">(</span>
    <span class="n">moons_X_test</span><span class="p">,</span> <span class="n">moons_y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s see how it works for the <em>mean</em> instance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">moons_mixup_sample_mean</span> <span class="o">=</span> <span class="n">moons_mixup_sampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
        <span class="n">moons_mean_point</span><span class="p">,</span>
        <span class="n">samples_number</span><span class="o">=</span><span class="n">moons_samples_number</span><span class="p">)</span>

<span class="n">moons_mixup_sample_mean_crisp</span> <span class="o">=</span> <span class="n">clf_moons_crisp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
    <span class="n">moons_mixup_sample_mean</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now, the <em>boundary</em> instance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">moons_mixup_sample_close</span> <span class="o">=</span> <span class="n">moons_mixup_sampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
    <span class="n">moons_boundary_point</span><span class="p">,</span>
    <span class="n">samples_number</span><span class="o">=</span><span class="n">moons_samples_number</span><span class="p">)</span>

<span class="n">moons_mixup_sample_close_crisp</span> <span class="o">=</span> <span class="n">clf_moons_crisp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
    <span class="n">moons_mixup_sample_close</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And the <em>far</em> instance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">moons_mixup_sample_far</span> <span class="o">=</span> <span class="n">moons_mixup_sampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
    <span class="n">moons_far_point</span><span class="p">,</span>
    <span class="n">samples_number</span><span class="o">=</span><span class="n">moons_samples_number</span><span class="p">)</span>

<span class="n">moons_mixup_sample_far_crisp</span> <span class="o">=</span> <span class="n">clf_moons_crisp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
    <span class="n">moons_mixup_sample_far</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now, let’s visualise these three samples side by side.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>

<span class="c1"># Scatter the data</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">moons_y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">moons_y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">moons_y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="c1"># Mean</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Mean Point&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_mixup_sample_mean</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">moons_mixup_sample_mean</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">moons_mixup_sample_mean_crisp</span><span class="p">,</span>
    <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_mean_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">moons_mean_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean Point&#39;</span><span class="p">)</span>

<span class="c1"># Close</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Close Point&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_mixup_sample_close</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">moons_mixup_sample_close</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">moons_mixup_sample_close_crisp</span><span class="p">,</span>
    <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_boundary_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">moons_boundary_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Boundary Point&#39;</span><span class="p">)</span>

<span class="c1"># Far</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Far Point&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_mixup_sample_far</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">moons_mixup_sample_far</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">moons_mixup_sample_far_crisp</span><span class="p">,</span>
    <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_far_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">moons_far_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Far Point&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.PathCollection at 0x11d5958b0&gt;
</pre></div>
</div>
<img alt="../../../_images/data_sampling_44_1.png" src="../../../_images/data_sampling_44_1.png" />
</div>
</div>
</section>
<section id="normal-class-discovery">
<h4>Normal Class Discovery<a class="headerlink" href="#normal-class-discovery" title="Permalink to this headline">¶</a></h4>
<p>Sampling with <em>Normal Class Discovery</em> is available via the
<a class="reference external" href="https://fat-forensics.org/generated/fatf.utils.data.augmentation.NormalClassDiscovery.html">fatf.data.utils.augmentation.NormalClassDiscovery</a>
class.</p>
<p>This sampler ensures that the generated sample has at least a predefined
proportion (<code class="docutils literal notranslate"><span class="pre">class_proportion_threshold</span></code> parameter) of every possible class.
For a specific data point, it samples with a normal distribution centred around
this point, incrementally increasing the standard deviation of the sample until
its class proportion (assigned by the predictive function) satisfies
the user-specified requirement.
Next, one of the data points found to be in another class is used as the centre
of the normal distribution sampling to discover another class.
These steps are repeated until all of the classes (in the predefined
proportion) are present in the sample.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">moons_discovery_sampler</span> <span class="o">=</span> <span class="n">fatf_augmentation</span><span class="o">.</span><span class="n">NormalClassDiscovery</span><span class="p">(</span>
    <span class="n">moons_X_test</span><span class="p">,</span>
    <span class="n">clf_moons_crisp</span><span class="o">.</span><span class="n">predict</span><span class="p">,</span>
    <span class="n">classes_number</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">class_proportion_threshold</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
    <span class="n">standard_deviation_init</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">standard_deviation_increment</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s see how it works for the <em>mean</em> instance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">moons_discovery_sample_mean</span> <span class="o">=</span> <span class="n">moons_discovery_sampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
        <span class="n">moons_mean_point</span><span class="p">,</span>
        <span class="n">samples_number</span><span class="o">=</span><span class="n">moons_samples_number</span><span class="p">)</span>

<span class="n">moons_discovery_sample_mean_crisp</span> <span class="o">=</span> <span class="n">clf_moons_crisp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
    <span class="n">moons_discovery_sample_mean</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now, the <em>boundary</em> instance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">moons_discovery_sample_close</span> <span class="o">=</span> <span class="n">moons_discovery_sampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
    <span class="n">moons_boundary_point</span><span class="p">,</span>
    <span class="n">samples_number</span><span class="o">=</span><span class="n">moons_samples_number</span><span class="p">)</span>

<span class="n">moons_discovery_sample_close_crisp</span> <span class="o">=</span> <span class="n">clf_moons_crisp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
    <span class="n">moons_discovery_sample_close</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And the <em>far</em> instance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">moons_discovery_sample_far</span> <span class="o">=</span> <span class="n">moons_discovery_sampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
    <span class="n">moons_far_point</span><span class="p">,</span>
    <span class="n">samples_number</span><span class="o">=</span><span class="n">moons_samples_number</span><span class="p">)</span>

<span class="n">moons_discovery_sample_far_crisp</span> <span class="o">=</span> <span class="n">clf_moons_crisp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
    <span class="n">moons_discovery_sample_far</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now, let’s visualise these three samples side by side.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>

<span class="c1"># Scatter the data</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">moons_y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">moons_y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">moons_y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="c1"># Mean</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Mean Point&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_discovery_sample_mean</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">moons_discovery_sample_mean</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">moons_discovery_sample_mean_crisp</span><span class="p">,</span>
    <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_mean_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">moons_mean_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean Point&#39;</span><span class="p">)</span>

<span class="c1"># Close</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Close Point&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_discovery_sample_close</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">moons_discovery_sample_close</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">moons_discovery_sample_close_crisp</span><span class="p">,</span>
    <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_boundary_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">moons_boundary_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Boundary Point&#39;</span><span class="p">)</span>

<span class="c1"># Far</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Far Point&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_discovery_sample_far</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">moons_discovery_sample_far</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">moons_discovery_sample_far_crisp</span><span class="p">,</span>
    <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_far_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">moons_far_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Far Point&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.PathCollection at 0x11d6d0970&gt;
</pre></div>
</div>
<img alt="../../../_images/data_sampling_54_1.png" src="../../../_images/data_sampling_54_1.png" />
</div>
</div>
</section>
<section id="samplers-comparison">
<h4>Samplers Comparison<a class="headerlink" href="#samplers-comparison" title="Permalink to this headline">¶</a></h4>
<p>To facilitate easier comparison of the samplers, let’s plot all of our results
within a single figure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">samplers_names</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Normal&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Truncated&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Mixup&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Discovery&#39;</span>
<span class="p">]</span>

<span class="n">moons_samplers</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[(</span><span class="n">moons_normal_sample_mean</span><span class="p">,</span> <span class="n">moons_normal_sample_mean_crisp</span><span class="p">),</span>
     <span class="p">(</span><span class="n">moons_normal_sample_close</span><span class="p">,</span> <span class="n">moons_normal_sample_close_crisp</span><span class="p">),</span>
     <span class="p">(</span><span class="n">moons_normal_sample_far</span><span class="p">,</span> <span class="n">moons_normal_sample_far_crisp</span><span class="p">)],</span>
    <span class="p">[(</span><span class="n">moons_truncated_sample_mean</span><span class="p">,</span> <span class="n">moons_truncated_sample_mean_crisp</span><span class="p">),</span>
     <span class="p">(</span><span class="n">moons_truncated_sample_close</span><span class="p">,</span> <span class="n">moons_truncated_sample_close_crisp</span><span class="p">),</span>
     <span class="p">(</span><span class="n">moons_truncated_sample_far</span><span class="p">,</span> <span class="n">moons_truncated_sample_far_crisp</span><span class="p">)],</span>
    <span class="p">[(</span><span class="n">moons_mixup_sample_mean</span><span class="p">,</span> <span class="n">moons_mixup_sample_mean_crisp</span><span class="p">),</span>
     <span class="p">(</span><span class="n">moons_mixup_sample_close</span><span class="p">,</span> <span class="n">moons_mixup_sample_close_crisp</span><span class="p">),</span>
     <span class="p">(</span><span class="n">moons_mixup_sample_far</span><span class="p">,</span> <span class="n">moons_mixup_sample_far_crisp</span><span class="p">)],</span>
    <span class="p">[(</span><span class="n">moons_discovery_sample_mean</span><span class="p">,</span> <span class="n">moons_discovery_sample_mean_crisp</span><span class="p">),</span>
     <span class="p">(</span><span class="n">moons_discovery_sample_close</span><span class="p">,</span> <span class="n">moons_discovery_sample_close_crisp</span><span class="p">),</span>
     <span class="p">(</span><span class="n">moons_discovery_sample_far</span><span class="p">,</span> <span class="n">moons_discovery_sample_far_crisp</span><span class="p">)]</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the different samples for mean, close and far data point with the class</span>
<span class="c1"># predicted by the crisp black box.</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Mean Point&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Close Point&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Far Point&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">samplers_names</span><span class="p">):</span>
    <span class="c1"># Formatting the subplot</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="c1"># Scatter the data</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">moons_y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">moons_y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">moons_y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    
    <span class="c1"># Mean</span>
    <span class="n">means_X</span><span class="p">,</span> <span class="n">means_y</span> <span class="o">=</span> <span class="n">moons_samplers</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">means_X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">means_X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">means_y</span><span class="p">,</span>
        <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">moons_mean_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">moons_mean_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean Point&#39;</span><span class="p">)</span>
    
    <span class="c1"># Close</span>
    <span class="n">close_X</span><span class="p">,</span> <span class="n">close_y</span> <span class="o">=</span> <span class="n">moons_samplers</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">close_X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">close_X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">close_y</span><span class="p">,</span>
        <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">moons_boundary_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">moons_boundary_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Boundary Point&#39;</span><span class="p">)</span>
    
    <span class="c1"># Far</span>
    <span class="n">far_X</span><span class="p">,</span> <span class="n">far_y</span> <span class="o">=</span> <span class="n">moons_samplers</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">far_X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">far_X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">far_y</span><span class="p">,</span>
        <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

    <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">moons_far_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">moons_far_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Far Point&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/data_sampling_57_0.png" src="../../../_images/data_sampling_57_0.png" />
</div>
</div>
</section>
</section>
<section id="measuring-sampling-quality">
<h3>Measuring Sampling Quality<a class="headerlink" href="#measuring-sampling-quality" title="Permalink to this headline">¶</a></h3>
<p>The final plot provides a comprehensive overview of our four sampling
approaches.
Diversity of our sample clearly depends on both:</p>
<ul class="simple">
<li><p>the location of the point around which we sample
(and its nearest black-box decision boundary); and</p></li>
<li><p>the sampling algorithm itself.</p></li>
</ul>
<p>Nonetheless, with a high-quality sampling strategy, the location of the
instance plays a smaller role – see the last two columns of the final plot.
<em>Mixup</em> and <em>Class Discovery</em> perform better than the <em>Normal</em> and
<em>Truncated Normal</em> samplers since they have a built-in advantage: they both work
with data labels (either ground truth or black-box predictions).</p>
<p>When sampling data locally to build our surrogate explainer, we should <strong>strive
for diversity of predictions</strong>.
Having a mixture of different classes is a sign of a nearby decision boundary,
which ultimately our surrogate tries to approximate.
With a higher than two number of dimensions, however, we cannot visually
inspect the diversity of our sample.
Instead, we can reuse the strategy from building interpretable representations
(see the <em>Interpretable Representation</em> notebook):</p>
<ul class="simple">
<li><p>if the model is probabilistic, we can measure <em>Mean Squared Error</em> of the
black-box predictions for our sampled data to understand their diversity; and</p></li>
<li><p>if the black box is <em>crisp</em>, we can do the same with <em>Gini Index</em>.</p></li>
</ul>
<p>In both cases we should strive for the highest possible number: 0.5 for Gini
Index when dealing with <strong>two</strong> classes, and 1.0 for MSE.
Since thus far we were using the crisp black box for our sampling experiments,
we will measure Gini Index of our samples.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bullet_format</span> <span class="o">=</span> <span class="s1">&#39;    -&gt; </span><span class="si">{}</span><span class="s1"> &lt;- : </span><span class="si">{:.3f}</span><span class="s1">&#39;</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">samplers_names</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**</span><span class="si">{}</span><span class="s1">** sampler:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

    <span class="n">gini_mean</span> <span class="o">=</span> <span class="n">xml_book</span><span class="o">.</span><span class="n">surrogates</span><span class="o">.</span><span class="n">gini_index</span><span class="p">(</span><span class="n">moons_samplers</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">bullet_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;mean instance &#39;</span><span class="p">,</span> <span class="n">gini_mean</span><span class="p">))</span>

    <span class="n">gini_close</span> <span class="o">=</span> <span class="n">xml_book</span><span class="o">.</span><span class="n">surrogates</span><span class="o">.</span><span class="n">gini_index</span><span class="p">(</span><span class="n">moons_samplers</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">bullet_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;close instance&#39;</span><span class="p">,</span> <span class="n">gini_close</span><span class="p">))</span>

    <span class="n">gini_far</span> <span class="o">=</span> <span class="n">xml_book</span><span class="o">.</span><span class="n">surrogates</span><span class="o">.</span><span class="n">gini_index</span><span class="p">(</span><span class="n">moons_samplers</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">bullet_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;far instance  &#39;</span><span class="p">,</span> <span class="n">gini_far</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>**Normal** sampler:
    -&gt; mean instance  &lt;- : 0.480
    -&gt; close instance &lt;- : 0.241
    -&gt; far instance   &lt;- : 0.113

**Truncated** sampler:
    -&gt; mean instance  &lt;- : 0.491
    -&gt; close instance &lt;- : 0.231
    -&gt; far instance   &lt;- : 0.077

**Mixup** sampler:
    -&gt; mean instance  &lt;- : 0.489
    -&gt; close instance &lt;- : 0.453
    -&gt; far instance   &lt;- : 0.403

**Discovery** sampler:
    -&gt; mean instance  &lt;- : 0.500
    -&gt; close instance &lt;- : 0.430
    -&gt; far instance   &lt;- : 0.461
</pre></div>
</div>
</div>
</div>
<p>These numbers confirm our visual findings.
Both <em>Mixup</em> and <em>Class Discovery</em> do a good job in finding a diverse
sample regardless of the sampling location.</p>
</section>
<section id="sampling-from-interpretable-representations">
<h3>Sampling from Interpretable Representations<a class="headerlink" href="#sampling-from-interpretable-representations" title="Permalink to this headline">¶</a></h3>
<p>The sampling procedure depends on the type of explained data.
For <em>images</em> and <em>text</em>, sampling <strong>must</strong> be performed in the
<strong>binary interpretable representation</strong> since doing it in the original
data domain is an ill-defined procedure (see the tutorial slides for more
details).
For <em>tabular data</em>, however, sampling can be done in <strong>either</strong> a binary
interpretable representation or the original data domain
(our experiments so far).</p>
<p>While there are many benefits of sampling in the original domain of tabular
data (such as controlling for locality and ensuring sample diversity),
some surrogate explainers (e.g., LIME) choose to sample in an interpretable
representation regardless of the data type.
While this procedure would be quite convoluted with a tree-based
interpretable representation – or even impossible given that the most
promising strategy is training the tree on a local sample –
it is just about feasible for the quartile-based interpretable representation.</p>
<p>In the popular LIME algorithm, for example, sampling is performed in the
<em>discretised</em> space of the quartile-based interpretable representation
and then transformed into:</p>
<ul class="simple">
<li><p>the <strong>binary representation</strong> for fitting a local surrogate model; and</p></li>
<li><p>the <strong>original data domain</strong> to predict the sample with a black box.</p></li>
</ul>
<p>While sampling directly in the binary domain is possible, doing so would add
<em>randomness</em> to the sample since going from the binary back into the
discrete domain requires choosing a hyper-rectangle at random
for any binary component that is 0
(see the <em>Interpretable Representation</em> notebook and the tutorial slides for reference).
Sampling from the <em>discrete</em> space instead does not fully
eradicate randomness since such a transformation is inherently <strong>stochastic</strong> –
there is one-to-many mapping between the discrete and the original data
domains.
As such, to perform this transformation one must randomly sample values
from each hyper-rectangle according to the distribution of training samples
located therein.
This step makes the explanation generator stochastic, which can be easily
avoided by sampling tabular data in their original domain.</p>
<hr class="docutils" />
<p>Let’s investigate the effect of sampling from a discretisation generated with
a quartile-based interpretable representation for our toy data set.</p>
<p>We start by building the <em>Quartile Discretiser</em> for our data set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">moons_discretiser</span> <span class="o">=</span> <span class="n">fatf_discretisation</span><span class="o">.</span><span class="n">QuartileDiscretiser</span><span class="p">(</span>
    <span class="n">moons_X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now, let’s sample 150 data points in this discrete space
(its values are between 0 and 3)
and identify their unique hyper-rectangles according to our
quartile-based discretisation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">moons_discrete_sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span>
    <span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="n">moons_discretiser</span><span class="o">.</span><span class="n">features_number</span><span class="p">),</span>
    <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>

<span class="c1"># Get hyper-rectangle assignment</span>
<span class="n">moons_discrete_sample_qid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
    <span class="n">moons_discrete_sample</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
<span class="n">unique_rows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">moons_discrete_sample</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_rows</span><span class="p">):</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">moons_discrete_sample</span> <span class="o">==</span> <span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">moons_discrete_sample_qid</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
</pre></div>
</div>
</div>
</div>
<p>To better understand the randomness caused by the <em>undiscretisation</em> step,
we will undiscretise our sample twice.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">undiscretised_dataset_1</span> <span class="o">=</span> <span class="n">xml_book</span><span class="o">.</span><span class="n">surrogates</span><span class="o">.</span><span class="n">undiscretise_data</span><span class="p">(</span>
    <span class="n">moons_discrete_sample</span><span class="p">,</span> <span class="n">moons_discretiser</span><span class="p">,</span> <span class="n">moons_X_test</span><span class="p">)</span>

<span class="n">undiscretised_dataset_2</span> <span class="o">=</span> <span class="n">xml_book</span><span class="o">.</span><span class="n">surrogates</span><span class="o">.</span><span class="n">undiscretise_data</span><span class="p">(</span>
    <span class="n">moons_discrete_sample</span><span class="p">,</span> <span class="n">moons_discretiser</span><span class="p">,</span> <span class="n">moons_X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Next, let’s visualise the results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Undiscretisation 1&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Undiscretisation 2&#39;</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">moons_y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">moons_X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Set1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">moons_y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">undiscretised_dataset_1</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">undiscretised_dataset_1</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">tab20</span><span class="p">,</span>
    <span class="n">c</span><span class="o">=</span><span class="n">moons_discrete_sample_qid</span><span class="p">,</span>
    <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">undiscretised_dataset_2</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">undiscretised_dataset_2</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">tab20</span><span class="p">,</span>
    <span class="n">c</span><span class="o">=</span><span class="n">moons_discrete_sample_qid</span><span class="p">,</span>
    <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="c1"># Draw quartile lines to show the hyper-rectangles</span>
<span class="n">quartile_boundaries_x</span> <span class="o">=</span> <span class="n">moons_discretiser</span><span class="o">.</span><span class="n">feature_bin_boundaries</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">quartile_boundaries_x</span><span class="p">:</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">quartile_boundaries_y</span> <span class="o">=</span> <span class="n">moons_discretiser</span><span class="o">.</span><span class="n">feature_bin_boundaries</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">quartile_boundaries_y</span><span class="p">:</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/data_sampling_69_0.png" src="../../../_images/data_sampling_69_0.png" />
</div>
</div>
<p>Clearly, the randomness of the <em>undiscretisation</em> step can be detrimental to reproducibility of surrogate explanations.
Nonetheless, this procedure is worth understanding to appreciate the simplicity
and level of control (over the sample characteristics) brought by performing
this procedure in the original domain of tabular data.</p>
<p>While in the case of the <em>Two Moons</em> data set the sampling results may not seem
too unreasonable, recall the overwhelming <em>number</em> of hyper-rectangles (<span class="math notranslate nohighlight">\(4^d\)</span> where <span class="math notranslate nohighlight">\(d\)</span>
is the number of features) and their <em>sparsity</em> for real-life data –
see the <em>Interpretable Representation</em> notebook for more details.
All in all, sampling from the original data domain may provide a better
opportunity to capture the local decision boundary.</p>
</section>
</section>
<section id="real-life-data-bikes-sharing">
<h2><span class="section-number">1.2.2. </span>Real-life Data – Bikes Sharing<a class="headerlink" href="#real-life-data-bikes-sharing" title="Permalink to this headline">¶</a></h2>
<p>Now, let’s repeat the same experiments for the bikes data set.
We will use <em>Normal</em>, <em>Truncated Normal</em>, <em>Mixup</em> and <em>Class Discovery</em>
samplers with three instances:</p>
<ul class="simple">
<li><p>the <em>mean</em> point of the data set;</p></li>
<li><p>a point close to a black-box decision boundary, i.e., as close as
possible to 0.3 probability for all three classes; and</p></li>
<li><p>a point far from a black-box decision boundary.</p></li>
</ul>
<p>We will then investigate the diversity of the resulting sample by
analysing the proportion of each class as well as measuring their
purity scores.</p>
<section id="loading-data-and-black-boxes">
<h3>Loading Data and Black Boxes<a class="headerlink" href="#loading-data-and-black-boxes" title="Permalink to this headline">¶</a></h3>
<p>We start by loading the <em>Bikes Sharing</em> data set and
fitting two black boxes: one probabilistic and one crisp.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">bikes_train_X</span><span class="p">,</span>
 <span class="n">bikes_test_X</span><span class="p">,</span>
 <span class="n">bikes_train_y</span><span class="p">,</span>
 <span class="n">bikes_test_y</span><span class="p">,</span>
 <span class="n">bikes_feature_names</span><span class="p">,</span>
 <span class="n">bikes_target_name</span><span class="p">)</span> <span class="o">=</span> <span class="n">xml_book</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">generate_bikes</span><span class="p">(</span><span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="n">bikes_target_classes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">,</span> <span class="s1">&#39;medium&#39;</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>22-Mar-21 18:34:02 fatf         INFO     Seeding RNGs using the input parameter.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>22-Mar-21 18:34:02 fatf         INFO     Seeding RNGs with 42.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clf_bikes_proba</span> <span class="o">=</span> <span class="n">xml_book</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">get_random_forest</span><span class="p">(</span>
    <span class="n">bikes_train_X</span><span class="p">,</span> <span class="n">bikes_train_y</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>22-Mar-21 18:34:06 fatf         INFO     Seeding RNGs using the input parameter.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>22-Mar-21 18:34:06 fatf         INFO     Seeding RNGs with 42.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clf_bikes_crisp</span> <span class="o">=</span> <span class="n">xml_book</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">get_svc</span><span class="p">(</span>
    <span class="n">bikes_train_X</span><span class="p">,</span> <span class="n">bikes_train_y</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>22-Mar-21 18:34:06 fatf         INFO     Seeding RNGs using the input parameter.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>22-Mar-21 18:34:06 fatf         INFO     Seeding RNGs with 42.
</pre></div>
</div>
</div>
</div>
</section>
<section id="choosing-instances">
<h3>Choosing Instances<a class="headerlink" href="#choosing-instances" title="Permalink to this headline">¶</a></h3>
<p>Now, we choose three instances to sample around.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bikes_test_pred_proba</span> <span class="o">=</span> <span class="n">clf_bikes_proba</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">bikes_test_X</span><span class="p">)</span>

<span class="c1"># Mean Point</span>
<span class="n">bikes_mean_point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">bikes_test_X</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">bikes_mean_point_pred_proba</span> <span class="o">=</span> <span class="n">clf_bikes_proba</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span>
    <span class="p">[</span><span class="n">bikes_mean_point</span><span class="p">])[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean Point Prediction: </span><span class="si">{}</span><span class="s1">.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bikes_mean_point_pred_proba</span><span class="p">))</span>

<span class="c1"># Far Point</span>
<span class="n">far_predict</span> <span class="o">=</span> <span class="n">bikes_test_pred_proba</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">far_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">far_predict</span><span class="p">)</span>

<span class="n">bikes_far_point</span> <span class="o">=</span> <span class="n">bikes_test_X</span><span class="p">[</span><span class="n">far_index</span><span class="p">,</span> <span class="p">:]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Far Point Prediction: </span><span class="si">{}</span><span class="s1">.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bikes_test_pred_proba</span><span class="p">[</span><span class="n">far_index</span><span class="p">,</span> <span class="p">:]))</span>

<span class="c1"># Close Point</span>
<span class="n">close_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">bikes_test_pred_proba</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">close_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">close_pred</span><span class="p">)</span>

<span class="n">bikes_close_point</span> <span class="o">=</span> <span class="n">bikes_test_X</span><span class="p">[</span><span class="n">close_index</span><span class="p">,</span> <span class="p">:]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Close Point Prediction: </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="n">bikes_test_pred_proba</span><span class="p">[</span><span class="n">close_index</span><span class="p">,</span> <span class="p">:]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean Point Prediction: [0.02451389 0.12835648 0.84712963].

Far Point Prediction: [1. 0. 0.].

Close Point Prediction: [0.2        0.45097643 0.34902357].
</pre></div>
</div>
</div>
</div>
</section>
<section id="testing-samplers">
<h3>Testing Samplers<a class="headerlink" href="#testing-samplers" title="Permalink to this headline">¶</a></h3>
<p>Instead of testing the samplers one by one, let’s analyse all of them at once,
akin to the side-by-side comparison of the samplers for the <em>Two Moons</em>
data set.</p>
<hr class="docutils" />
<p>We start by defining the samplers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">samplers_names</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Normal&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Truncated&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Mixup&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Discovery&#39;</span>
<span class="p">]</span>

<span class="n">bikes_samplers</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">fatf_augmentation</span><span class="o">.</span><span class="n">NormalSampling</span><span class="p">(</span><span class="n">bikes_test_X</span><span class="p">),</span>
    <span class="n">fatf_augmentation</span><span class="o">.</span><span class="n">TruncatedNormalSampling</span><span class="p">(</span><span class="n">bikes_test_X</span><span class="p">),</span>
    <span class="n">fatf_augmentation</span><span class="o">.</span><span class="n">Mixup</span><span class="p">(</span>
        <span class="n">bikes_test_X</span><span class="p">,</span>
        <span class="n">bikes_test_y</span><span class="p">),</span>
    <span class="n">fatf_augmentation</span><span class="o">.</span><span class="n">NormalClassDiscovery</span><span class="p">(</span>
        <span class="n">bikes_test_X</span><span class="p">,</span>
        <span class="n">clf_bikes_crisp</span><span class="o">.</span><span class="n">predict</span><span class="p">,</span>
        <span class="n">classes_number</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">class_proportion_threshold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
        <span class="n">standard_deviation_init</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">standard_deviation_increment</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we generate 1500 samples around our three instances.</p>
<blockquote>
<div><p><strong>Note:</strong>    
The <em>Normal Class Discovery</em> algorithm is sensitive to parameterisation.
It may throw a <code class="docutils literal notranslate"><span class="pre">RuntimeError</span></code> if it fails to discover the user-defined
proportion of classes (the <code class="docutils literal notranslate"><span class="pre">class_proportion_threshold</span></code> parameter in the class above).
In this case, you should tune the <code class="docutils literal notranslate"><span class="pre">standard_deviation_init</span></code> and
<code class="docutils literal notranslate"><span class="pre">standard_deviation_increment</span></code> parameters to reflect the distribution of
features in your data.
Another approach is to increase the number of iterations when calling the
<code class="docutils literal notranslate"><span class="pre">sample</span></code> method using its <code class="docutils literal notranslate"><span class="pre">max_iter</span></code> parameter (see below).</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fatf</span><span class="o">.</span><span class="n">setup_random_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="n">bikes_samples_number</span> <span class="o">=</span> <span class="mi">1500</span>

<span class="n">bikes_mean_sample</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bikes_mean_sample_pred</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bikes_close_sample</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bikes_close_sample_pred</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bikes_far_sample</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bikes_far_sample_pred</span><span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">sampler_name</span><span class="p">,</span> <span class="n">sampler</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">samplers_names</span><span class="p">,</span> <span class="n">bikes_samplers</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">sampler_name</span> <span class="o">==</span> <span class="s1">&#39;Discovery&#39;</span><span class="p">:</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;max_iter&#39;</span><span class="p">:</span> <span class="mi">2500</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="c1"># Mean Point</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
        <span class="n">bikes_mean_point</span><span class="p">,</span>
        <span class="n">samples_number</span><span class="o">=</span><span class="n">bikes_samples_number</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">bikes_mean_sample</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>

    <span class="n">sample_pred</span> <span class="o">=</span> <span class="n">clf_bikes_crisp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
    <span class="n">bikes_mean_sample_pred</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample_pred</span><span class="p">)</span>
    
    <span class="c1"># Close Point</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
        <span class="n">bikes_close_point</span><span class="p">,</span>
        <span class="n">samples_number</span><span class="o">=</span><span class="n">bikes_samples_number</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">bikes_close_sample</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>

    <span class="n">sample_pred</span> <span class="o">=</span> <span class="n">clf_bikes_crisp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
    <span class="n">bikes_close_sample_pred</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample_pred</span><span class="p">)</span>
    
    <span class="c1"># Far Point</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
        <span class="n">bikes_far_point</span><span class="p">,</span>
        <span class="n">samples_number</span><span class="o">=</span><span class="n">bikes_samples_number</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">bikes_far_sample</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>

    <span class="n">sample_pred</span> <span class="o">=</span> <span class="n">clf_bikes_crisp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
    <span class="n">bikes_far_sample_pred</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>22-Mar-21 18:34:06 fatf         INFO     Seeding RNGs using the input parameter.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>22-Mar-21 18:34:06 fatf         INFO     Seeding RNGs with 42.
</pre></div>
</div>
</div>
</div>
<p>Now, let’s visualise the class counts and compute <em>Gini Impurity</em> of each
sample.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The bins used for the bikes dataset</span>
<span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4000</span><span class="p">,</span> <span class="mi">6000</span><span class="p">,</span> <span class="mi">9000</span><span class="p">]</span>
<span class="n">bin_names</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;</span><span class="si">{:.0f}</span><span class="s1">&lt;=y&lt;</span><span class="si">{:.0f}</span><span class="se">\n</span><span class="s1">Low&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
    <span class="s1">&#39;</span><span class="si">{:.0f}</span><span class="s1">&lt;=y&lt;</span><span class="si">{:.0f}</span><span class="se">\n</span><span class="s1">Medium&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bins</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
    <span class="s1">&#39;</span><span class="si">{:.0f}</span><span class="s1">&lt;=y&lt;</span><span class="si">{:.0f}</span><span class="se">\n</span><span class="s1">High&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">bins</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Mean Point&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Close Point&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Far Point&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">samplers_names</span><span class="p">):</span>
    <span class="c1"># Formatting the subplot</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    
    <span class="c1"># Mean Point</span>
    <span class="n">mean_predictions</span> <span class="o">=</span> <span class="n">bikes_mean_sample_pred</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">mean_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">mean_predictions</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">bin_names</span><span class="p">,</span> <span class="n">mean_counts</span><span class="p">)</span>
    
    <span class="c1"># Close Point</span>
    <span class="n">close_predictions</span> <span class="o">=</span> <span class="n">bikes_close_sample_pred</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">close_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">close_predictions</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">bin_names</span><span class="p">,</span> <span class="n">close_counts</span><span class="p">)</span>

    <span class="c1"># Far Point</span>
    <span class="n">far_predictions</span> <span class="o">=</span> <span class="n">bikes_far_sample_pred</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">far_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">far_predictions</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">bin_names</span><span class="p">,</span> <span class="n">far_counts</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/data_sampling_83_0.png" src="../../../_images/data_sampling_83_0.png" />
</div>
</div>
<p>(With <em>three</em> classes, the maximum impurity is <span class="math notranslate nohighlight">\(\frac{2}{3}\)</span>.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bullet_format</span> <span class="o">=</span> <span class="s1">&#39;    -&gt; </span><span class="si">{}</span><span class="s1"> &lt;- : </span><span class="si">{:.3f}</span><span class="s1">&#39;</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">samplers_names</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**</span><span class="si">{}</span><span class="s1">** sampler:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

    <span class="n">gini_mean</span> <span class="o">=</span> <span class="n">xml_book</span><span class="o">.</span><span class="n">surrogates</span><span class="o">.</span><span class="n">gini_index</span><span class="p">(</span><span class="n">bikes_mean_sample_pred</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">bullet_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;mean instance &#39;</span><span class="p">,</span> <span class="n">gini_mean</span><span class="p">))</span>

    <span class="n">gini_close</span> <span class="o">=</span> <span class="n">xml_book</span><span class="o">.</span><span class="n">surrogates</span><span class="o">.</span><span class="n">gini_index</span><span class="p">(</span><span class="n">bikes_close_sample_pred</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">bullet_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;close instance&#39;</span><span class="p">,</span> <span class="n">gini_close</span><span class="p">))</span>

    <span class="n">gini_far</span> <span class="o">=</span> <span class="n">xml_book</span><span class="o">.</span><span class="n">surrogates</span><span class="o">.</span><span class="n">gini_index</span><span class="p">(</span><span class="n">bikes_far_sample_pred</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">bullet_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;far instance  &#39;</span><span class="p">,</span> <span class="n">gini_far</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>**Normal** sampler:
    -&gt; mean instance  &lt;- : 0.655
    -&gt; close instance &lt;- : 0.646
    -&gt; far instance   &lt;- : 0.190

**Truncated** sampler:
    -&gt; mean instance  &lt;- : 0.611
    -&gt; close instance &lt;- : 0.643
    -&gt; far instance   &lt;- : 0.511

**Mixup** sampler:
    -&gt; mean instance  &lt;- : 0.625
    -&gt; close instance &lt;- : 0.601
    -&gt; far instance   &lt;- : 0.647

**Discovery** sampler:
    -&gt; mean instance  &lt;- : 0.640
    -&gt; close instance &lt;- : 0.641
    -&gt; far instance   &lt;- : 0.583
</pre></div>
</div>
</div>
</div>
<p>These numbers reflect our findings from the frequency plots.</p>
</section>
</section>
<section id="summary">
<h2><span class="section-number">1.2.3. </span>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Throughout this notebook we relied on <em>Gini Impurity</em> and <em>crisp</em> classifiers.
Nonetheless, a similar strategy for finding a useful data sample can be taken
when dealing with <em>probabilistic</em> models – we need to replacing <em>Gini Impurity</em>
with <em>Mean Squared Error</em>.</p>
<hr class="docutils" />
<p>Now, let’s move on to the <em>Explanation Generation</em> notebook and use our
knowledge of building faithful interpretable representations and sampling
diverse data points to build a surrogate explainer.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./book/meta_explainers/surrogates"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="interpretable_representations.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">1.1. </span>Binary Interpretable Representations for Tabular Data</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="explanation_generation.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">1.3. </span>Explanation Generation</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By <a href="mailto:kacper@xmlx.io">Kacper Sokol</a> and <a href="mailto:team@xmlx.io">XMLX Team</a> – <a href="https://xmlx.io/">xmlx.io</a>.<br> Distributed under <a href="https://github.com/xmlx-io/xml-book/blob/master/LICENCE">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International Licence</a>.
<br/>
    
        &copy; Copyright 2021–2022.<br/>
      <div class="extra_footer">
        <p> This book delivers a comprehensive outlook on the most popular explainability concepts in Machine Learning. It covers a range of theoretical and practical topics across different difficulty levels, including but not limited to: high-level overviews & introductory examples; mathematical foundations; algorithmic implementations; practical advice & real-life caveats; and success & failure case studies. </p>

      </div>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>